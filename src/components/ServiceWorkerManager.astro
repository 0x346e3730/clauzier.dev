---
// Service Worker registration and management
---

<script>
  // Register service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
      try {
        const registration = await navigator.serviceWorker.register('/sw.js');
        console.log('[SW] Registration successful:', registration.scope);
        
        // Listen for service worker messages
        navigator.serviceWorker.addEventListener('message', event => {
          if (event.data && event.data.type === 'CACHE_UPDATED') {
            console.log('[SW] Cache updated for:', event.data.url);
          }
        });
        
      } catch (error) {
        console.error('[SW] Registration failed:', error);
      }
    });
  }
  
  // Handle offline/online status
  function updateNetworkStatus() {
    const isOnline = navigator.onLine;
    document.body.classList.toggle('offline', !isOnline);
    
    // Show/hide offline indicator
    let indicator = document.getElementById('network-indicator');
    if (!isOnline && !indicator) {
      indicator = document.createElement('div');
      indicator.id = 'network-indicator';
      indicator.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(255, 0, 0, 0.9);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-family: monospace;
        z-index: 10000;
        font-size: 0.9rem;
      `;
      indicator.textContent = 'âš  Offline Mode';
      document.body.appendChild(indicator);
    } else if (isOnline && indicator) {
      indicator.remove();
    }
  }
  
  window.addEventListener('online', updateNetworkStatus);
  window.addEventListener('offline', updateNetworkStatus);
  
  // Initial status check
  updateNetworkStatus();
  
  // Preload critical pages on interaction
  const preloadPages = ['/blog/', '/resume/'];
  let preloadTriggered = false;
  
  function preloadCriticalPages() {
    if (preloadTriggered) return;
    preloadTriggered = true;
    
    preloadPages.forEach(url => {
      const link = document.createElement('link');
      link.rel = 'prefetch';
      link.href = url;
      document.head.appendChild(link);
    });
  }
  
  // Trigger preload on first user interaction
  ['mousedown', 'touchstart', 'keydown'].forEach(event => {
    document.addEventListener(event, preloadCriticalPages, { once: true, passive: true });
  });
</script>

<style>
  /* Offline mode styling */
  body.offline {
    filter: grayscale(0.3);
  }
  
  body.offline::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: repeating-linear-gradient(
      90deg,
      #ff6b6b 0px,
      #ff6b6b 10px,
      transparent 10px,
      transparent 20px
    );
    z-index: 10000;
    animation: offline-stripe 1s linear infinite;
  }
  
  @keyframes offline-stripe {
    0% { transform: translateX(-20px); }
    100% { transform: translateX(0); }
  }
</style>